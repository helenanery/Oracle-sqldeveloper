

drop TABLE departamentos;

CREATE TABLE departamentos (
  id_dep NUMBER PRIMARY KEY,
  nome_dep VARCHAR2(100)
);

-- Exemplo de registros:
INSERT INTO departamentos (id_dep, nome_dep) VALUES (1, 'TI');
INSERT INTO departamentos (id_dep, nome_dep) VALUES (2, 'RH');
INSERT INTO departamentos (id_dep, nome_dep) VALUES (3, 'Financeiro');
INSERT INTO departamentos (id_dep, nome_dep) VALUES (4, 'Marketing');
INSERT INTO departamentos (id_dep, nome_dep) VALUES (5, 'Operações');

SELECT * FROM departamentos;

entos;

drop table log_funcionarios;
CREATE TABLE log_funcionarios (
    id_log    NUMBER  GENERATED ALWAYS AS IDENTITY,
    acao      VARCHAR2(50),
    data_acao DATE,
    usuario   VARCHAR2(50)
);

select * from log_funcionarios;

drop trigger trg_log_insert_funcionarios;
CREATE OR REPLACE TRIGGER trg_log_insert_funcionarios
AFTER INSERT ON funcionarios
FOR EACH ROW
BEGIN
  INSERT INTO log_funcionarios (acao, data_acao, usuario)
  VALUES ('INSERT', SYSDATE, USER);
END;
/

select * from log_funcionarios;

drop TRIGGER trg_salario_update;

set serveroutput on
CREATE OR REPLACE TRIGGER trg_salario_update
BEFORE UPDATE ON funcionarios
FOR EACH ROW
WHEN (NEW.salario > OLD.salario)
BEGIN
  DBMS_OUTPUT.PUT_LINE('Salário aumentado de ' || :OLD.salario || ' para ' || :NEW.salario);
END;
/

drop table funcionarios;
CREATE TABLE funcionarios (
  id      NUMBER PRIMARY KEY,
  nome    VARCHAR2(100),
  salario NUMBER,
  id_dep NUMBER REFERENCES departamentos(id_dep)
);

INSERT INTO funcionarios (id, nome, salario, id_dep) VALUES (101, 'Ana Paula Souza',      4500.00, 1);
INSERT INTO funcionarios (id, nome, salario, id_dep) VALUES (102, 'Bruno Henrique Lima',  5200.00, 1);
INSERT INTO funcionarios (id, nome, salario, id_dep) VALUES (103, 'Carlos Eduardo Alves', 3800.00, 2);
INSERT INTO funcionarios (id, nome, salario, id_dep) VALUES (104, 'Daniela Ferreira',     4100.00, 2);
INSERT INTO funcionarios (id, nome, salario, id_dep) VALUES (105, 'Eduardo Martins',      6300.00, 3);
INSERT INTO funcionarios (id, nome, salario, id_dep) VALUES (106, 'Fernanda Oliveira',    4700.00, 3);
INSERT INTO funcionarios (id, nome, salario, id_dep) VALUES (107, 'Gabriel Costa',        4800.00, 4);
INSERT INTO funcionarios (id, nome, salario, id_dep) VALUES (108, 'Helena Rocha',         5100.00, 4);
INSERT INTO funcionarios (id, nome, salario, id_dep) VALUES (109, 'Igor Pires',           3900.00, 5);
INSERT INTO funcionarios (id, nome, salario, id_dep) VALUES (110, 'Juliana Lima',         5600.00, 5);
INSERT INTO funcionarios (id, nome, salario, id_dep) VALUES (111, 'Kaio Mendes',          4600.00, 1);
INSERT INTO funcionarios (id, nome, salario, id_dep) VALUES (112, 'Larissa Moreira',      3400.00, 2);
INSERT INTO funcionarios (id, nome, salario, id_dep) VALUES (113, 'Marcelo Ramos',        6000.00, 3);
INSERT INTO funcionarios (id, nome, salario, id_dep) VALUES (114, 'Natália Borges',       3700.00, 4);
INSERT INTO funcionarios (id, nome, salario, id_dep) VALUES (115, 'Otávio Teixeira',      4500.00, 5);
INSERT INTO funcionarios (id, nome, salario, id_dep) VALUES (116, 'Patrícia Gomes',       3200.00, 1);
INSERT INTO funcionarios (id, nome, salario, id_dep) VALUES (117, 'Rafael Almeida',       5800.00, 3);
INSERT INTO funcionarios (id, nome, salario, id_dep) VALUES (118, 'Sabrina Nogueira',     4900.00, 2);
INSERT INTO funcionarios (id, nome, salario, id_dep) VALUES (119, 'Thiago Santana',       5500.00, 4);
INSERT INTO funcionarios (id, nome, salario, id_dep) VALUES (120, 'Vanessa Castro',       4300.00, 5);
INSERT INTO funcionarios (id, nome, salario, id_dep) VALUES (121, 'Sérgio Oliveira',       4700.00, 1);

SELECT * FROM funcionarios;

COMMIT;

CREATE OR REPLACE VIEW vw_funcionarios_dep AS
SELECT f.id, f.nome, d.nome_dep
FROM funcionarios f
JOIN departamentos d ON f.id_dep = d.id_dep;

select * from vw_funcionarios_dep;

CREATE OR REPLACE TRIGGER trg_insert_vw_funcionarios
INSTEAD OF INSERT ON teste.vw_funcionarios_dep
FOR EACH ROW
BEGIN
  -- Insere apenas na tabela funcionarios, assumindo que o departamento já exista
  INSERT INTO funcionarios (id, none, id_dep)
  VALUES (:NEW.id, :NEW.nome,
          (SELECT id_dep FROM departamentos WHERE nome_dep = :NEW.nome_dep));
END;
/
INSERT INTO vw_funcionarios_dep (id, nome, id_dep) VALUES (101, 'Fulano de Tal',      5500.00, 3);



UPDATE funcionarios
SET salario = 6000
WHERE id = 101;

commit;

select * from log_funcionarios;

CREATE TABLE exemplo01 (
    id NUMBER GENERATED ALWAYS AS IDENTITY,
    nome VARCHAR2(20)
);

INSERT INTO exemplo01 (nome)  values ('AAAAA');
INSERT INTO exemplo01 (nome)  values (10, 'BBBBB');
INSERT INTO exemplo01 (nome)  values ('CCCCC');

select * from teste.exemplo01;

CREATE TABLE exemplo02 (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY,
    nome VARCHAR2(20)
);

INSERT INTO exemplo02 values (10, 'AAAAA');
commit;
select * from teste.exemplo02;

CREATE TABLE funcionarios_teste (
  id_log NUMBER GENERATED ALWAYS AS IDENTITY,
  acao VARCHAR2(50),
  data_acao DATE,
  usuario VARCHAR2(50)
);

INSERT INTO funcionarios_teste (acao, data_acao, usuario)
VALUES ('INSERT', SYSDATE, USER);

commit;

select * from funcionarios_teste;